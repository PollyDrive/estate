# Troubleshooting Guide

–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–µ—à–µ–Ω–∏—é —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å RealtyBot-Bali.

## –ü—Ä–æ–±–ª–µ–º—ã —Å –∑–∞–ø—É—Å–∫–æ–º

### –ë–æ—Ç –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏ —Å—Ä–∞–∑—É –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
- –û—à–∏–±–∫–∏ –ø—Ä–∏ `docker-compose up`

**–†–µ—à–µ–Ω–∏–µ:**

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:
```bash
docker-compose logs bot
docker-compose logs postgres
```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
```bash
docker-compose exec bot env | grep API
docker-compose exec bot env | grep DATABASE
```

3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `.env` –∑–∞–ø–æ–ª–Ω–µ–Ω—ã:
```bash
cat .env
```

4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ PostgreSQL –∑–∞–ø—É—Å—Ç–∏–ª—Å—è:
```bash
docker-compose ps
```

5. –ï—Å–ª–∏ PostgreSQL –Ω–µ –≥–æ—Ç–æ–≤, –ø–æ–¥–æ–∂–¥–∏—Ç–µ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞:
```bash
docker-compose restart bot
```

### –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

**–°–∏–º–ø—Ç–æ–º—ã:**
```
psycopg2.OperationalError: could not connect to server
```

**–†–µ—à–µ–Ω–∏–µ:**

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ PostgreSQL –∑–∞–ø—É—â–µ–Ω:
```bash
docker-compose ps postgres
```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ healthcheck:
```bash
docker-compose logs postgres | grep "database system is ready"
```

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ `.env`:
```env
DATABASE_URL=postgresql://realty_user:your_password@postgres:5432/realty_bot
```

4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–∞—Ä–æ–ª—å –≤ `DATABASE_URL` —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å `POSTGRES_PASSWORD`

5. –ü–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:
```bash
docker-compose down
docker-compose up -d
```

### Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã

**–°–∏–º–ø—Ç–æ–º—ã:**
```
ModuleNotFoundError: No module named 'anthropic'
```

**–†–µ—à–µ–Ω–∏–µ:**

1. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ Docker –æ–±—Ä–∞–∑:
```bash
docker-compose build --no-cache
docker-compose up -d
```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `requirements.txt` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

## –ü—Ä–æ–±–ª–µ–º—ã —Å–æ —Å–±–æ—Ä–æ–º –¥–∞–Ω–Ω—ã—Ö

### –ù–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏–π

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ë–æ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ, –Ω–æ –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏–π
- –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç "Scraped 0 listings"

**–†–µ—à–µ–Ω–∏–µ:**

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL –≤ `config.json`:
```json
{
  "apify": {
    "marketplace_urls": [
      "https://www.facebook.com/marketplace/..."
    ]
  }
}
```

2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ URL –≤–∞–ª–∏–¥–Ω—ã ‚Äî –æ—Ç–∫—Ä–æ–π—Ç–µ –∏—Ö –≤ –±—Ä–∞—É–∑–µ—Ä–µ

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Apify API key –∞–∫—Ç–∏–≤–µ–Ω:
   - –ó–∞–π–¥–∏—Ç–µ –Ω–∞ https://console.apify.com/
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–∏–º–∏—Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Apify:
```bash
docker-compose logs bot | grep -i apify
```

5. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —É–º–µ–Ω—å—à–∏—Ç—å `max_listings` –≤ `config.json`

### Apify API –æ—à–∏–±–∫–∏

**–°–∏–º–ø—Ç–æ–º—ã:**
```
Error scraping Apify: 401 Unauthorized
Error scraping Apify: 429 Too Many Requests
```

**–†–µ—à–µ–Ω–∏–µ –¥–ª—è 401:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å `APIFY_API_KEY` –≤ `.env`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–ª—é—á –Ω–µ –∏—Å—Ç–µ–∫

**–†–µ—à–µ–Ω–∏–µ –¥–ª—è 429:**
- –í—ã –ø—Ä–µ–≤—ã—Å–∏–ª–∏ –ª–∏–º–∏—Ç—ã Apify
- –£–º–µ–Ω—å—à–∏—Ç–µ —á–∞—Å—Ç–æ—Ç—É –∑–∞–ø—É—Å–∫–æ–≤ –≤ `crontab`
- –£–º–µ–Ω—å—à–∏—Ç–µ `max_listings` –≤ `config.json`
- –ü–æ–¥–æ–∂–¥–∏—Ç–µ –¥–æ —Å–±—Ä–æ—Å–∞ –ª–∏–º–∏—Ç–æ–≤

### –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –æ—Ç Apify

**–°–∏–º–ø—Ç–æ–º—ã:**
```
KeyError: 'title'
Listing has no ID, skipping
```

**–†–µ—à–µ–Ω–∏–µ:**

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∫–∞–∫–∏–µ –ø–æ–ª—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç Apify:
```bash
docker-compose logs bot | grep -A 10 "Scraped"
```

2. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `src/apify_scraper.py`, –º–µ—Ç–æ–¥ `normalize_listing()`:
```python
def normalize_listing(self, raw_listing: Dict[str, Any]) -> Dict[str, str]:
    return {
        'fb_id': raw_listing.get('id', ''),           # –ú–æ–∂–µ—Ç –±—ã—Ç—å 'listing_id'
        'title': raw_listing.get('title', ''),        # –ú–æ–∂–µ—Ç –±—ã—Ç—å 'name'
        'price': raw_listing.get('price', ''),        # –ú–æ–∂–µ—Ç –±—ã—Ç—å 'priceText'
        'location': raw_listing.get('location', ''),
        'listing_url': raw_listing.get('url', ''),    # –ú–æ–∂–µ—Ç –±—ã—Ç—å 'link'
        'description': raw_listing.get('description', '')
    }
```

3. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:
```bash
docker-compose up --build -d
```

## –ü—Ä–æ–±–ª–µ–º—ã —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π

### –í—Å–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –æ—Ç–∫–ª–æ–Ω—è—é—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ú–Ω–æ–≥–æ –Ω–æ–≤—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π, –Ω–æ –Ω–∏ –æ–¥–Ω–æ –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç —Ñ–∏–ª—å—Ç—Ä—ã
- "Level 0 FAILED" –¥–ª—è –≤—Å–µ—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π

**–†–µ—à–µ–Ω–∏–µ:**

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –≤ `config.json`:

```json
{
  "filters": {
    "price": {
      "min": 3000000,
      "max": 8000000
    }
  }
}
```

2. –†–∞—Å—à–∏—Ä—å—Ç–µ —Ü–µ–Ω–æ–≤–æ–π –¥–∏–∞–ø–∞–∑–æ–Ω, –µ—Å–ª–∏ —Ü–µ–Ω—ã –≤ –¥—Ä—É–≥–æ–º —Ñ–æ—Ä–º–∞—Ç–µ

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–æ–ø-—Å–ª–æ–≤–∞ ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ, –æ–Ω–∏ —Å–ª–∏—à–∫–æ–º –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ

4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ required_words ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ, –æ–±—ä—è–≤–ª–µ–Ω–∏—è –Ω–∞ –¥—Ä—É–≥–æ–º —è–∑—ã–∫–µ

5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤ debug —Ä–µ–∂–∏–º–µ:
```bash
docker-compose exec bot python3 /app/src/main.py
```

### LLM —Ñ–∏–ª—å—Ç—Ä—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç

**–°–∏–º–ø—Ç–æ–º—ã:**
```
Groq API error: 401 Unauthorized
Claude API error: authentication_error
```

**–†–µ—à–µ–Ω–∏–µ –¥–ª—è Groq:**

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `GROQ_API_KEY` –≤ `.env`
2. –ü–æ–ª—É—á–∏—Ç–µ –Ω–æ–≤—ã–π –∫–ª—é—á –Ω–∞ https://console.groq.com/
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ –º–æ–¥–µ–ª–∏ `llama-3.1-8b-instant`

**–†–µ—à–µ–Ω–∏–µ –¥–ª—è Claude:**

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `ANTHROPIC_API_KEY` –≤ `.env`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å –∫—Ä–µ–¥–∏—Ç—ã –Ω–∞ –∞–∫–∫–∞—É–Ω—Ç–µ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–∏–º–∏—Ç—ã API –Ω–∞ https://console.anthropic.com/

**Rate limits:**

–ï—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω—ã –ª–∏–º–∏—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤:
- –£–≤–µ–ª–∏—á—å—Ç–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª –≤ `crontab` (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ä–∞–∑ –≤ 2 —á–∞—Å–∞)
- –£–º–µ–Ω—å—à–∏—Ç–µ `max_listings` –≤ `config.json`

### Groq –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç

**–°–∏–º–ø—Ç–æ–º—ã:**
- Groq –æ—Ç–≤–µ—á–∞–µ—Ç —á—Ç–æ-—Ç–æ –∫—Ä–æ–º–µ YES/NO
- "Level 1 FAILED" –¥–ª—è –æ–±—ä—è–≤–ª–µ–Ω–∏–π —Å –∫—É—Ö–Ω–µ–π

**–†–µ—à–µ–Ω–∏–µ:**

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–æ–º—Ç –≤ `config.json`:
```json
{
  "llm": {
    "groq": {
      "prompt_template": "You are a real estate assistant. Read the description. Answer only 'YES' or 'NO'. Is there a kitchen or kitchenette suitable for cooking? Description: {description}"
    }
  }
}
```

2. –£–≤–µ–ª–∏—á—å—Ç–µ `max_tokens` –µ—Å–ª–∏ –æ—Ç–≤–µ—Ç –æ–±—Ä–µ–∑–∞–µ—Ç—Å—è

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤:
```bash
docker-compose logs bot | grep -i groq
```

### Claude –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π JSON

**–°–∏–º–ø—Ç–æ–º—ã:**
```
JSON parse error
No JSON found in Claude response
```

**–†–µ—à–µ–Ω–∏–µ:**

1. –£–ª—É—á—à–∏—Ç–µ –ø—Ä–æ–º—Ç –≤ `config.json`:
```json
{
  "llm": {
    "claude": {
      "prompt_template": "...\n\n–û—Ç–≤–µ—Ç—å –°–¢–†–û–ì–û –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON:\n{\"summary_ru\": \"...\", \"msg_en\": \"...\", \"msg_id\": \"...\"}"
    }
  }
}
```

2. –£–≤–µ–ª–∏—á—å—Ç–µ `max_tokens`:
```json
{
  "llm": {
    "claude": {
      "max_tokens": 1000
    }
  }
}
```

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—ã—Ä–æ–π –æ—Ç–≤–µ—Ç Claude –≤ –ª–æ–≥–∞—Ö:
```bash
docker-compose logs bot | grep -A 20 "Claude"
```

## –ü—Ä–æ–±–ª–µ–º—ã —Å Telegram

### Telegram –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è

**–°–∏–º–ø—Ç–æ–º—ã:**
```
Failed to send Telegram notification
Telegram API error: 401 Unauthorized
```

**–†–µ—à–µ–Ω–∏–µ –¥–ª—è 401:**

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `TELEGRAM_BOT_TOKEN` –≤ `.env`
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–≥–æ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ [@BotFather](https://t.me/botfather)
3. –ü–æ–ª—É—á–∏—Ç–µ –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω –∫–æ–º–∞–Ω–¥–æ–π `/newbot`

**–†–µ—à–µ–Ω–∏–µ –¥–ª—è 403 Forbidden:**

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–æ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –≥—Ä—É–ø–ø—É
2. –°–¥–µ–ª–∞–π—Ç–µ –±–æ—Ç–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –≥—Ä—É–ø–ø—ã
3. –î–∞–π—Ç–µ –±–æ—Ç—É –ø—Ä–∞–≤–∞ –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π

### –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π Chat ID

**–°–∏–º–ø—Ç–æ–º—ã:**
```
Telegram API error: 400 Bad Request: chat not found
```

**–†–µ—à–µ–Ω–∏–µ:**

1. –ü–æ–ª—É—á–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π Chat ID:

```bash
# –û—Ç–ø—Ä–∞–≤—å—Ç–µ –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É –∏–ª–∏ –≤ –≥—Ä—É–ø–ø—É —Å –±–æ—Ç–æ–º
curl https://api.telegram.org/bot<YOUR_TOKEN>/getUpdates
```

2. –ù–∞–π–¥–∏—Ç–µ `chat.id` –≤ –æ—Ç–≤–µ—Ç–µ:
```json
{
  "result": [
    {
      "message": {
        "chat": {
          "id": -1001234567890  // –≠—Ç–æ –≤–∞—à Chat ID
        }
      }
    }
  ]
}
```

3. –î–ª—è –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –≥—Ä—É–ø–ø Chat ID –æ–±—ã—á–Ω–æ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `-100`

4. –û–±–Ω–æ–≤–∏—Ç–µ `.env`:
```env
TELEGRAM_CHAT_ID=-1001234567890
```

### –°–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ù–µ—Ç —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –û—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ Markdown

**–†–µ—à–µ–Ω–∏–µ:**

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —à–∞–±–ª–æ–Ω –≤ `config.json`:
```json
{
  "telegram": {
    "message_template": "üè° *–ù–æ–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç!*\n\n..."
  }
}
```

2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã Markdown —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω—ã:
   - `*` –¥–ª—è –∂–∏—Ä–Ω–æ–≥–æ
   - `_` –¥–ª—è –∫—É—Ä—Å–∏–≤–∞
   - `` –¥–ª—è –º–æ–Ω–æ—à–∏—Ä–∏–Ω–Ω–æ–≥–æ

3. –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç—Å—è, —Å–º–µ–Ω–∏—Ç–µ `parse_mode`:

–í `src/telegram_notifier.py`:
```python
payload = {
    'chat_id': self.chat_id,
    'text': message,
    'parse_mode': 'HTML',  # –í–º–µ—Å—Ç–æ 'Markdown'
}
```

## –ü—Ä–æ–±–ª–µ–º—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º—ã:**
```
relation "fb_listings" does not exist
```

**–†–µ—à–µ–Ω–∏–µ:**

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `db/init.sql` —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:
```bash
docker-compose exec postgres ls -la /docker-entrypoint-initdb.d/
```

2. –ü–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ –ë–î —Å –Ω—É–ª—è:
```bash
docker-compose down -v  # –£–¥–∞–ª–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ!
docker-compose up -d
```

3. –ò–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É –≤—Ä—É—á–Ω—É—é:
```bash
docker-compose exec postgres psql -U realty_user -d realty_bot -f /docker-entrypoint-initdb.d/init.sql
```

### –î—É–±–ª–∏–∫–∞—Ç—ã –æ–±—ä—è–≤–ª–µ–Ω–∏–π

**–°–∏–º–ø—Ç–æ–º—ã:**
- –û–¥–Ω–æ –∏ —Ç–æ –∂–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑

**–†–µ—à–µ–Ω–∏–µ:**

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å `fb_id`:
```bash
docker-compose exec postgres psql -U realty_user -d realty_bot
```

```sql
SELECT fb_id, COUNT(*) 
FROM fb_listings 
GROUP BY fb_id 
HAVING COUNT(*) > 1;
```

2. –ï—Å–ª–∏ –µ—Å—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã, —É–¥–∞–ª–∏—Ç–µ –∏—Ö:
```sql
DELETE FROM fb_listings a USING fb_listings b
WHERE a.id > b.id AND a.fb_id = b.fb_id;
```

3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ constraint —Å—É—â–µ—Å—Ç–≤—É–µ—Ç:
```sql
\d fb_listings
```

4. –ï—Å–ª–∏ –Ω–µ—Ç UNIQUE constraint, –¥–æ–±–∞–≤—å—Ç–µ:
```sql
ALTER TABLE fb_listings ADD CONSTRAINT fb_id_unique UNIQUE (fb_id);
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞–ø–æ–ª–Ω–µ–Ω–∞

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ú–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞
- –û—à–∏–±–∫–∏ –Ω–µ—Ö–≤–∞—Ç–∫–∏ –º–µ—Å—Ç–∞

**–†–µ—à–µ–Ω–∏–µ:**

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä –ë–î:
```bash
docker-compose exec postgres psql -U realty_user -d realty_bot
```

```sql
SELECT pg_size_pretty(pg_database_size('realty_bot'));
```

2. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π:
```sql
SELECT COUNT(*) FROM fb_listings;
```

3. –£–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏ (—Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π):
```sql
DELETE FROM fb_listings 
WHERE created_at < NOW() - INTERVAL '30 days';
```

4. Vacuum –ë–î:
```sql
VACUUM FULL fb_listings;
```

## –ü—Ä–æ–±–ª–µ–º—ã —Å Cron

### Cron –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ë–æ—Ç –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –≤ `/var/log/cron.log`

**–†–µ—à–µ–Ω–∏–µ:**

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ cron —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ:
```bash
docker-compose exec bot ps aux | grep cron
```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ crontab:
```bash
docker-compose exec bot crontab -l
```

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ —Ñ–∞–π–ª:
```bash
docker-compose exec bot ls -la /etc/cron.d/realty-bot-cron
```

4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ cron:
```bash
docker-compose exec bot cat /var/log/cron.log
```

5. –ï—Å–ª–∏ –ø—É—Å—Ç–æ, –ø–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:
```bash
docker-compose up --build -d
```

### Cron –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–∫—Ä–∏–ø—Ç

**–°–∏–º–ø—Ç–æ–º—ã:**
- Cron —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ —Å–∫—Ä–∏–ø—Ç –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—É—Ç—å –∫ Python:
```bash
docker-compose exec bot which python3
```

2. –û–±–Ω–æ–≤–∏—Ç–µ `crontab` —Å –ø–æ–ª–Ω—ã–º –ø—É—Ç—ë–º:
```
0 * * * * cd /app && /usr/local/bin/python3 /app/src/main.py >> /var/log/cron.log 2>&1
```

3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –µ—Å—Ç—å –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ –≤ –∫–æ–Ω—Ü–µ —Ñ–∞–π–ª–∞ `crontab`

4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è cron:
```bash
docker-compose exec bot env
```

5. –ï—Å–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –Ω–µ—Ç, –¥–æ–±–∞–≤—å—Ç–µ –∏—Ö –≤ `crontab`:
```
DATABASE_URL=postgresql://...
0 * * * * cd /app && /usr/local/bin/python3 /app/src/main.py >> /var/log/cron.log 2>&1
```

## –û–±—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### –õ–æ–≥–∏ –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º—ã:**
- –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `logs/` –ø—É—Å—Ç–∞—è

**–†–µ—à–µ–Ω–∏–µ:**

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é:
```bash
ls -la logs/
```

2. –°–æ–∑–¥–∞–π—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é, –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç:
```bash
mkdir -p logs
chmod 777 logs
```

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ logging –≤ `config.json`:
```json
{
  "logging": {
    "file": "logs/realty_bot.log"
  }
}
```

4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:
```bash
docker-compose restart bot
```

### –í—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–Ω–æ–≥–æ CPU/RAM
- VPS —Ç–æ—Ä–º–æ–∑–∏—Ç

**–†–µ—à–µ–Ω–∏–µ:**

1. –£–º–µ–Ω—å—à–∏—Ç–µ `max_listings` –≤ `config.json`

2. –£–≤–µ–ª–∏—á—å—Ç–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª cron (—Ä–µ–∂–µ –∑–∞–ø—É—Å–∫–∏)

3. –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ —Ä–µ—Å—É—Ä—Å—ã Docker –≤ `docker-compose.yml`:
```yaml
services:
  bot:
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 512M
```

4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏ –≤ –ª–æ–≥–∞—Ö

### –ù—É–∂–Ω–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–µ–∫—Ç

**–†–µ—à–µ–Ω–∏–µ:**

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å –≤—Å—ë
docker-compose down -v

# –£–¥–∞–ª–∏—Ç—å –æ–±—Ä–∞–∑—ã
docker rmi estate-bot

# –£–¥–∞–ª–∏—Ç—å –ª–æ–≥–∏
rm -rf logs/*

# –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å
docker-compose up --build -d
```

## –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–º–æ—â–∏

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–µ–Ω–∞:

1. –°–æ–±–µ—Ä–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é:
```bash
docker-compose ps
docker-compose logs bot > bot_logs.txt
docker-compose logs postgres > postgres_logs.txt
cat .env.example  # –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–π—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–π .env!
```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Issues –Ω–∞ GitHub

3. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π Issue —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º:
   - –ß—Ç–æ –≤—ã –ø—ã—Ç–∞–ª–∏—Å—å —Å–¥–µ–ª–∞—Ç—å
   - –ß—Ç–æ –æ–∂–∏–¥–∞–ª–∏
   - –ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ
   - –õ–æ–≥–∏ –∏ –≤–µ—Ä—Å–∏–∏

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å—ë
docker-compose restart

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å —Å –Ω—É–ª—è
docker-compose up --build -d

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –ª–æ–≥–∏
docker-compose logs -f

# –ó–∞–π—Ç–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –±–æ—Ç–∞
docker-compose exec bot /bin/bash

# –ó–∞–π—Ç–∏ –≤ PostgreSQL
docker-compose exec postgres psql -U realty_user -d realty_bot

# –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞
docker-compose exec bot python3 /app/src/main.py

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
docker-compose exec bot env
```
